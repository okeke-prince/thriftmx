"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},7144:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{POST:()=>d});var n=r(49303),o=r(88716),s=r(60670),i=r(16385),u=r(47165),c=r(87070);async function d(e){try{let t=await e.json(),r=e?.cookies?.get("customer_jwt_token")?.value;if(!await (0,u.PZ)(r))return c.NextResponse.json({message:"Unauthorized!"},{status:401});for(let e of(await i.db.buyerMaster.update({where:{email:t.customerEmail},data:{address:t.address,city:t.city}}),t.products)){let t=await i.db.product.findUnique({where:{id:parseInt(e.id)}}),r=t?.[e.size]-e.quantity,a=t?.currentStock-e.quantity;await i.db.product.update({where:{id:parseInt(e.id)},data:{[e.size]:r,currentStock:a}})}let a=new Date(1e3*t.SODateTime),n=await i.db.salesMaster.create({data:{bId:parseInt(t.customerId),SODateTime:a,grandTotalPrice:t.grandTotalPrice,paymentMode:t.paymentMode}});for(let e of t.products)await i.db.salesTransaction.create({data:{SMOId:n.id,productId:parseInt(e.id),productName:e.name,unitPrice:e.sellPrice,qtyPurchased:e.quantity,total:e.quantity*e.sellPrice}});return c.NextResponse.json({message:"Order Placed Successfully."})}catch(e){return c.NextResponse.json({message:"Something Went Wrong.",error:e.message},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"/Users/test/Downloads/nextjs-13.13-ChartSectionComponent/src/app/api/checkout/route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:h}=p,w="/api/checkout/route";function x(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},16385:(e,t,r)=>{r.d(t,{db:()=>a});let a=new(r(53524)).PrismaClient},47165:(e,t,r)=>{r.d(t,{PZ:()=>c,XX:()=>u,cn:()=>i,p6:()=>d});var a=r(55761),n=r(6091),o=r(6176),s=r(62386);function i(...e){return(0,s.m6)((0,a.Z)(e))}async function u(e){return await new n.N({...e}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("2h").sign(new TextEncoder().encode(process.env.JWT_SECRET))}async function c(e){try{let{payload:t}=await (0,o._)(e,new TextEncoder().encode(process.env.JWT_SECRET));return t}catch(e){return!1}}function d(e){return new Date(e).toLocaleDateString("en-IN",{timeZone:"UTC"})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,810,972],()=>r(7144));module.exports=a})();